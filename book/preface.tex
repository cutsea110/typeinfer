
\chapter{前書き}

この本は、単純型付き$\lambda$計算からパラメトリック多相入りの型システム程度の範囲での型推論について、
体系的かつ理論と実装に一対一の対応が現れる形でまとめた本です。最後まで読めばHindley-Milner
の型推論アルゴリズム$\mathcal W$の理論と実装を理解できることを目標としています。

型推論とは、静的型付きのプログラミング言語において、
その型情報の欠けたプログラムから変数や式の型を推論する仕組みのことです。
Hindley-Milnerの型推論アルゴリズムは、
多くのプログラミング言語処理系における型推論の基礎となっているアルゴリズムです。

そもそも、Hindley-Milner型推論アルゴリズムを学ぶことにはどのような意味があるのでしょうか。
著者は、この問いに対する答えは三つあると考えています。

一つ目は、型推論を持つ静的型付けのプログラミング言語の処理系を作る上で、
避けては通れない道であるということです。
しかし、それだけの理由で型推論を学ぶ必要がある人はごく僅かしかいません。

二つ目は、型推論の仕組みを知ることで、
型推論の機能を持つ言語処理系の型に関するメッセージが圧倒的に理解しやすくなるということです。

OCaml\footnote{http://caml.inria.fr/}やHaskell\footnote{http://haskell.org/}、
その他類似の型推論機能を持つ言語を使っていて、
型エラーの意味する所が良く分からないことがあると思います。
そのエラーは、型推論の過程で整合性が取れないと分かった部分を示しているのです。
よって、型推論アルゴリズムを学ぶことで、型エラーに対する理解がより一層深くなると考えられます。
また、Haskellではトップレベルの束縛に型を書くのが正しい習慣とされていますが、
それも型推論の仕組みを逆手に取り、分かりづらい型エラーを抑制する意味があります。

三つ目は、型推論のアルゴリズムを学ぶのはとても楽しいということです。

私自身も、型推論について学ぶ過程で、多くの発見や驚くことがありました。
また、そのような楽しさを今後も提供してくれるものの一つだと考えています。

この本を手に取った読者の方々も、型推論を知る過程で多くの楽しさを見出すのではないかと期待しています。

これらの理由から、型推論を持つプログラミング言語を使っているプログラマにとって、
型推論を学ぶことはとても大きな意味があると考えられます。

\section*{対象読者}

読者は関数型プログラミングの達人である必要はありません。
ただし、ある程度HaskellやOCamlやその他類似の言語での関数型言語らしいプログラムの書き方を
理解していることを前提としています。

\section*{型推論の実装について}

本書で用いるいくつかの型推論の実装は、全て以下のツールとライブラリを用いて記述されています。

\begin{itemize}
 \item OCaml 3.12.1
 \item OCaml 3.12.1標準ライブラリ
 \item Jane Street's coreライブラリ\footnote{http://ocaml.janestreet.com/?q=node=13}
\end{itemize}

この型推論の実装は全て著者の坂口によるものです。

本書の内容には、全てのソースコードは含めないようにしています。
完全なソースコードは、以下のURIからダウンロードできます。

http://github.com/pi8027/typeinfer/tree/first-edition/src

本書に関わる型推論の実装は何種類かの実装からなり、それぞれを別々のディレクトリに分けています。
これらのディレクトリの名前は、それぞれ本書の内容と以下のように対応しています。

\begin{description}
  \item[stlc] 単純型付き$\lambda$計算の型推論 ($\mathcal C$, $\mathcal U$)
  \item[poly] 置き換えによる多相型の型推論 ($\mathcal C^\mathrm{let}$)
  \item[parametric-poly1] パラメトリック多相の型推論 ($\mathcal C^\mathrm{let'}$)
  \item[parametric-poly2] アルゴリズム$\mathcal W$
\end{description}

それぞれの実装は、五つのファイルに分割されています。

\begin{description}
  \item[def.ml] データ型定義
  \item[infer.ml] 型推論
  \item[lexer.mll] 字句解析器
  \item[parser.mly] 構文解析器
  \item[main.ml] フロントエンド
\end{description}

字句解析器と構文解析器は、それぞれ ocamllex と ocamlyacc を用いて記述されています。
残りのファイルはOCamlのプログラムです。

型推論器だけが必要な場合は、\texttt{def.ml}と\texttt{infer.ml}だけで良いことになります。

\section*{謝辞}

この本は、筑波大学情報科学類の情報特別演習の演習課題で制作したものです。

まず、情報特別演習の担当アドバイザ教員として指導して下さった前田敦司先生に、
本書の重要な部分に関わる多くの助言を下さった亀山幸義先生に感謝します。

私一人ではこの本を作るのに十分な知識がありませんでしたが、多くの方々に助けていただきました。
型推論の基礎は、川中真耶(mayah)さんに教えていただきました。
OCamlとJane Street's coreライブラリに関する多くのことを、古瀬淳さんに教えていただきました。
\LaTeX{}に関する多くのことを、鹿野桂一郎さんに教えていただきました。
本書の正しさに関わるいくつかのことを、上里友弥(ranha)さんに教えていただきました。
ありがとうございます。

本書の草稿は、八人の方にレビューをしていただきました。
伊東勝利さん、武藤雅幸さん、原将己(qnighy)さん、姜帆さん、林拓人さん、
日比野啓さん、石井大海さん、えりっくさん、ありがとうございます。

\begin{flushright}
2011年12月

坂口和彦
\end{flushright}

