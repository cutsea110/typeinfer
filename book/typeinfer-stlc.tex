
この章から、本題である所の型推論について説明していきます。

\section{型推論とは}

型推論とは、項からその項の型を計算する事です。

最近の多くの言語処理系はプログラムにおける型を計算するための型推論の機能を持っており、
一部のプログラマにとっても身近かつ必要不可欠な物となっているでしょう。

単純型付き $\lambda$ 計算の型推論が何をする物なのか、1章で説明した型判定を使って説明してみましょう。

仮に、型推論を任意の型環境 $\Gamma$ と任意の $\lambda$ 項 $e$ に対し、$\Gamma \vdash e : t$
であるような型 $t$ を計算する操作としてみましょう。

しかし、これには以下に示した2つの問題点があります。

\begin{enumerate}
  \item 型が付けられない $\lambda$ 項に関しては、解が存在しません。
  \item 無数の解が存在するケースがあります。例えば、型環境 $\emptyset$ の下で項 $\lambda x . x$ は
		$\alpha \to \alpha$ や $(\alpha \to \beta) \to \alpha \to \beta$ など、
		$?_0 \to ?_0$ の形を持つ型全てで型付けできます。
\end{enumerate}

まず、1番目は解があるか無いかを判定し、解がある場合のみ型を計算する物としましょう。

2番目に関しては、最も広い範囲を指す型の表現、つまり $\lambda x . x$ に対する $?_0 \to ?_0$
のような型を計算する物としましょう。

以上をまとめて、単純型付き $\lambda$ 計算の型推論を以下のように定義します。

\begin{definition}[単純型付き $\lambda$ 計算の型推論]
単純型付き $\lambda$ 計算の型推論は、任意の型環境 $\Gamma$ と任意の $\lambda$ 項 $e$ に対し、
$\Gamma \vdash e : t$ であるような型 $t$ が存在するかを計算する。
また、もしそのような型が存在するのであればその $t$ のうち最も広い範囲の型を計算する。
\end{definition}

この定義のような型推論は、決定可能である事が知られています。
型推論のアルゴリズムについて考えていきましょう。

\section{アルゴリズム}

型推論のアルゴリズムは、大きく分けて型に関する方程式の生成と、
その方程式を解く2つの部分によって構成されています。

ここでいう方程式とは、型の等式集合の事です。1章で出てきた実際に型を付けてみる例では、
とある型ととある型が同一であるという等式はその場で解いてしまっていましたが、
ここではまずこの等式集合を生成し、それを後から解くという方針を取ります。

型環境 $\emptyset$ の下で $\lambda f . \lambda g . \lambda x . f \, x \, (g \, x)$
という $\lambda$ 項がどのような型を持つか、という例で型の等式集合を作ってみましょう。

まず、外側は $\lambda$ 抽象なので、
\[
  \infere{T-Abs}{
    \emptyset \vdash \lambda f . \lambda g . \lambda x . f \, x \, (g \, x) : ?_0 \to ?_1
  }{
    \{f : ?_0\} \vdash \lambda g . \lambda x . f \, x \, (g \, x) : ?_1
  }
\]
と書けます。この時点での等式集合は空です。

次も $\lambda$ 抽象なので、
\[
  \infere{T-Abs}{
    \emptyset \vdash \lambda f . \lambda g . \lambda x . f \, x \, (g \, x) : ?_0 \to ?_1
  }{
    \infere{T-Abs}{
	  \{f : ?_0\} \vdash \lambda g . \lambda x . f \, x \, (g \, x) : ?_1
	}{
	  \{f : ?_0 ,g : ?_2\} \vdash \lambda x . f \, x \, (g \, x) : ?_3
	}
  }
\]
となります。ここで、上の \textsc{T-Abs} 規則の制約により、
$?_1 = ?_2 \to ?_3$ という制約が追加されます。



\subsection{方程式の生成}



\subsection{制約解消系}



\section{実装}



